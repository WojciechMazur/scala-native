name: 'Unix tests env setup'
description: 'Used to setup Unix tests environemt'
inputs:
  scala-version: 
    required: true
  cache-docker-image:
    required: true
    default: true
outputs:
runs:
  using: "composite"
  steps:
    - name: Calculate binary version
      run: |
        version=${{ inputs.scala-version }}
        echo "binary-version=${version%.*}" >> $GITHUB_ENV

    # Loads cache with dependencies created in test-tools job
    - name: Cache dependencies
      uses: actions/cache@v2
      with:
        path: |
          ~/.cache/coursier
          ~/.sbt/boot
        key: ${{ runner.os }}-deps-${{ env.binary-version }}-${{ hashFiles('**/*.sbt') }}-${{ hashFiles('**/build.properties') }}

    # Loads cached content of local docker registry containing built images.
    - name: Cache docker
      if: inputs.cache-docker-image == true
      uses: actions/cache@v1
      with:
        path: /tmp/docker-registry
        key: docker-registry-${{ hashFiles('ci-docker/Dockerfile') }}